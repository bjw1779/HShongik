<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>í™ìµëŒ€ ì œ1ê¸°ìˆ™ì‚¬ ì‹¤ì‹œê°„ ì‘ì—… í˜„í™©íŒ</title>
<style>
body {margin:0;font-family:Arial,sans-serif;background:#f4f6f8;}
.header{position:relative;height:300px;background:url("hongik_dormitory.jpg") center/cover no-repeat;}
.header::after{content:"";position:absolute;inset:0;background:rgba(0,0,0,0.45);}
.header h1{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:36px;font-weight:bold;text-align:center;}
.container{padding:30px;background:#fff;margin-top:-50px;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,0.1);}
.datetime{text-align:center;font-size:28px;font-weight:bold;margin:40px 0 30px 0;color:#333;}
.control{text-align:right;margin-bottom:10px;}
table{width:100%;border-collapse:collapse;background:#fff;}
th,td{border:1px solid #ccc;padding:8px;text-align:center;}
th:nth-child(1),td:nth-child(1){width:40px;min-width:40px;}
th:nth-child(2),td:nth-child(2){width:200px;min-width:200px;}
th:nth-child(3),td:nth-child(3){width:200px;min-width:200px;}
th:nth-child(4),td:nth-child(4){width:200px;min-width:200px;}
th:nth-child(5),td:nth-child(5){width:auto;}
td.status{font-weight:bold;}
th:nth-child(7),td:nth-child(7){width:80px;min-width:80px;}
th{background:#333;color:#fff;}
input,select{width:90%;padding:5px;text-align:center;box-sizing:border-box;}
.time-box{display:flex;gap:5px;justify-content:center;}
.no{font-weight:bold;background:#f1f1f1;}
.working{background-color:#007bff;color:#fff;}
.finished{background-color:#d3d3d3;color:#000;}
button{padding:5px 8px;cursor:pointer;margin-left:5px;}
</style>
</head>
<body>

<div class="header"><h1>í™ìµëŒ€ ì œ1ê¸°ìˆ™ì‚¬ ì‹¤ì‹œê°„ ì‘ì—… í˜„í™©íŒ</h1></div>
<div class="container">
<div class="datetime" id="datetime"></div>

<div class="control">
    <button onclick="addRow()">â• ì¤„ ì¶”ê°€</button>
    <button onclick="saveTable()">ğŸ’¾ ì €ì¥ & ë¶ˆëŸ¬ì˜¤ê¸°</button>
</div>

<table>
<thead>
<tr>
<th>ìˆœë²ˆ</th>
<th>ì—…ì²´ëª…</th>
<th>êµ¬ì—­</th>
<th>ì‘ì—…ì‹œê°„</th>
<th>ì‘ì—…ë‚´ìš©</th>
<th>ìƒíƒœ</th>
<th>ê´€ë¦¬</th>
</tr>
</thead>
<tbody id="table-body"></tbody>
</table>
</div>

<script>
// ===== ë‚ ì§œ/ì‹œê°„ =====
function updateDateTime(){
    const dt=new Date();
    const y=dt.getFullYear(), m=String(dt.getMonth()+1).padStart(2,"0"), d=String(dt.getDate()).padStart(2,"0");
    const hh=dt.getHours(), mm=String(dt.getMinutes()).padStart(2,"0"), ss=String(dt.getSeconds()).padStart(2,"0");
    document.getElementById("datetime").textContent=`${y}-${m}-${d} ${String(hh).padStart(2,'0')}:${mm}:${ss}`;
}
setInterval(updateDateTime,1000);
updateDateTime();

// ===== í…Œì´ë¸” =====
const times=[];
for(let h=6;h<=20;h++) times.push(String(h).padStart(2,"0")+":00");
function timeOptions(sel){return times.map(t=>`<option ${t===sel?"selected":""}>${t}</option>`).join("");}

let rowsTemp=[];

function render(){
    const tbody=document.getElementById("table-body");
    tbody.innerHTML="";
    rowsTemp.forEach((r,i)=>{
        tbody.innerHTML+=`
        <tr>
        <td class="no">${i+1}</td>
        <td><input value="${r.company||""}" onchange="update(${i},'company',this.value)" placeholder="ì—…ì²´ëª… ì…ë ¥"></td>
        <td><input value="${r.area}" onchange="update(${i},'area',this.value)"></td>
        <td><div class="time-box"><select onchange="update(${i},'start',this.value)">${timeOptions(r.start)}</select>~<select onchange="update(${i},'end',this.value)">${timeOptions(r.end)}</select></div></td>
        <td><input value="${r.task}" onchange="update(${i},'task',this.value)"></td>
        <td class="status ${r.status}" onclick="toggleStatus(${i})">${r.status==="working"?"ì‘ì—…ì¤‘":"ì‘ì—…ì¢…ë£Œ"}</td>
        <td><button onclick="removeRow(${i})">ğŸ—‘ ì‚­ì œ</button></td>
        </tr>`;
    });
}

function update(i,k,v){rowsTemp[i][k]=v;}
function toggleStatus(i){rowsTemp[i].status=rowsTemp[i].status==="working"?"finished":"working"; render();}
function addRow(){rowsTemp.push({company:"",area:"êµ¬ì—­",start:"08:00",end:"17:00",task:"ì‘ì—…ë‚´ìš© ì…ë ¥",status:"working"});render();}
function removeRow(i){rowsTemp.splice(i,1); render();}

// ===== ì„œë²„ ì €ì¥ + ë¶ˆëŸ¬ì˜¤ê¸° =====
const SERVER_URL = "http://YOUR_PC_IP:3000";

function saveTable(){
    fetch(`${SERVER_URL}/save`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(rowsTemp)
    }).then(res=>res.json())
      .then(data=>{
          // ì €ì¥ í›„ ìë™ ë¶ˆëŸ¬ì˜¤ê¸°
          fetchLatestData();
      })
      .catch(err=>alert("ì €ì¥ ì‹¤íŒ¨ âŒ"));
}

// ì„œë²„ì—ì„œ ìµœì‹  ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
function fetchLatestData(){
    fetch(`${SERVER_URL}/load`)
    .then(res=>res.json())
    .then(data=>{
        rowsTemp=data;
        render();
    })
    .catch(err=>console.log("ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨ âŒ"));
}

// ===== ì´ˆê¸° 10ì¤„ =====
function initRows(){
    rowsTemp = [];
    for(let i=0;i<10;i++) addRow();
}
initRows();

// ===== ì£¼ê¸°ì  ìë™ ê°±ì‹  (10ì´ˆë§ˆë‹¤) =====
setInterval(fetchLatestData,10000);
</script>
</body>
</html>
